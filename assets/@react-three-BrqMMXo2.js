import{r as f,j as U}from"./react-B5MDO8QK.js";import{L as Se,T as Ft,R as It,U as Ht,a as Wt,O as Ne,P as Be,S as Je,b as Ce,N as Nt,A as Bt,B as $t,M as Ut,C as ft,V as $,c as $e,W as Vt,d as Gt,e as qt,f as Zt,g as Xt,h as Yt,i as Kt,D as Jt,j as we,k as Qt,l as er,m as tr,n as Fe,o as ae,p as rr,q as nr}from"./three-BpMn_lgO.js";import{u as or}from"./react-use-measure-C4jZHtQf.js";import{F as ir,u as sr}from"./its-fine-DIIw4VH7.js";import{R as ar,c as se}from"./react-reconciler-Cw807X9j.js";import{s as Qe}from"./scheduler-CzFDRTuY.js";import{_ as ee}from"./@babel-CF3RwP-h.js";import{c as lr}from"./react-dom-CVo7Y5HB.js";import{c as dt}from"./zustand-3hBhX-Hx.js";import"./maath-BEABJQwW.js";import{G as Ue,D as cr,M as Re,O as ur}from"./three-stdlib-ngbH9uKm.js";import{s as fr,p as dr,c as pr}from"./suspend-react-BKIKQNXN.js";const Ve={},mr=e=>void Object.assign(Ve,e);function vr(e,t){function n(r,{args:o=[],attach:c,...h},y){let P=`${r[0].toUpperCase()}${r.slice(1)}`,d;if(r==="primitive"){if(h.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=h.object;d=oe(l,{type:r,root:y,attach:c,primitive:!0})}else{const l=Ve[P];if(!l)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");d=oe(new l(...o),{type:r,root:y,attach:c,memoizedProps:{args:o}})}return d.__r3f.attach===void 0&&(d instanceof $t?d.__r3f.attach="geometry":d instanceof Ut&&(d.__r3f.attach="material")),P!=="inject"&&Ae(d,h),d}function i(r,o){let c=!1;if(o){var h,y;(h=o.__r3f)!=null&&h.attach?je(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),c=!0),c||(y=r.__r3f)==null||y.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=r,He(o),ie(o)}}function a(r,o,c){let h=!1;if(o){var y,P;if((y=o.__r3f)!=null&&y.attach)je(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:o});const d=r.children.filter(v=>v!==o),l=d.indexOf(c);r.children=[...d.slice(0,l),o,...d.slice(l)],h=!0}h||(P=r.__r3f)==null||P.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=r,He(o),ie(o)}}function s(r,o,c=!1){r&&[...r].forEach(h=>m(o,h,c))}function m(r,o,c){if(o){var h,y,P;if(o.__r3f&&(o.__r3f.parent=null),(h=r.__r3f)!=null&&h.objects&&(r.__r3f.objects=r.__r3f.objects.filter(M=>M!==o)),(y=o.__r3f)!=null&&y.attach)ot(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var d;r.remove(o),(d=o.__r3f)!=null&&d.root&&_r(Ee(o),o)}const v=(P=o.__r3f)==null?void 0:P.primitive,x=!v&&(c===void 0?o.dispose!==null:c);if(!v){var l;s((l=o.__r3f)==null?void 0:l.objects,o,x),s(o.children,o,x)}if(delete o.__r3f,x&&o.dispose&&o.type!=="Scene"){const M=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Qe.unstable_scheduleCallback(Qe.unstable_IdlePriority,M):M()}ie(r)}}function p(r,o,c,h){var y;const P=(y=r.__r3f)==null?void 0:y.parent;if(!P)return;const d=n(o,c,r.__r3f.root);if(r.children){for(const l of r.children)l.__r3f&&i(d,l);r.children=r.children.filter(l=>!l.__r3f)}r.__r3f.objects.forEach(l=>i(d,l)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||m(P,r),d.parent&&(d.__r3f.autoRemovedBeforeAppend=!0),i(P,d),d.raycast&&d.__r3f.eventCount&&Ee(d).getState().internal.interaction.push(d),[h,h.alternate].forEach(l=>{l!==null&&(l.stateNode=d,l.ref&&(typeof l.ref=="function"?l.ref(d):l.ref.current=d))})}const u=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:ar({createInstance:n,removeChild:m,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const c=r.getState().scene;c.__r3f&&(c.__r3f.root=r,i(c,o))},removeChildFromContainer:(r,o)=>{o&&m(r.getState().scene,o)},insertInContainerBefore:(r,o,c)=>{if(!o||!c)return;const h=r.getState().scene;h.__r3f&&a(h,o,c)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,c,h){var y;if(((y=r==null?void 0:r.__r3f)!=null?y:{}).primitive&&h.object&&h.object!==r)return[!0];{const{args:d=[],children:l,...v}=h,{args:x=[],children:M,...E}=c;if(!Array.isArray(d))throw new Error("R3F: the args prop must be an array!");if(d.some((C,R)=>C!==x[R]))return[!0];const b=wt(r,v,E,!0);return b.changes.length?[!1,b]:null}},commitUpdate(r,[o,c],h,y,P,d){o?p(r,h,P,d):Ae(r,c)},commitMount(r,o,c,h){var y;const P=(y=r.__r3f)!=null?y:{};r.raycast&&P.handlers&&P.eventCount&&Ee(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>oe(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:c,parent:h}=(o=r.__r3f)!=null?o:{};c&&h&&ot(h,r,c),r.isObject3D&&(r.visible=!1),ie(r)},unhideInstance(r,o){var c;const{attach:h,parent:y}=(c=r.__r3f)!=null?c:{};h&&y&&je(y,r,h),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),ie(r)},createTextInstance:u,hideTextInstance:u,unhideTextInstance:u,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&L.fun(performance.now)?performance.now:L.fun(Date.now)?Date.now:()=>0,scheduleTimeout:L.fun(setTimeout)?setTimeout:void 0,cancelTimeout:L.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var et,tt;const Oe=e=>"colorSpace"in e||"outputColorSpace"in e,pt=()=>{var e;return(e=Ve.ColorManagement)!=null?e:null},mt=e=>e&&e.isOrthographicCamera,hr=e=>e&&e.hasOwnProperty("current"),ve=typeof window<"u"&&((et=window.document)!=null&&et.createElement||((tt=window.navigator)==null?void 0:tt.product)==="ReactNative")?f.useLayoutEffect:f.useEffect;function vt(e){const t=f.useRef(e);return ve(()=>void(t.current=e),[e]),t}function gr({set:e}){return ve(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ht extends f.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ht.getDerivedStateFromError=()=>({error:!0});const gt="__default",rt=new Map,yr=e=>e&&!!e.memoized&&!!e.changes;function yt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Ee(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const L={obj:e=>e===Object(e)&&!L.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(L.str(e)||L.num(e)||L.boo(e))return e===t;const s=L.obj(e);if(s&&i==="reference")return e===t;const m=L.arr(e);if(m&&n==="reference")return e===t;if((m||s)&&e===t)return!0;let p;for(p in e)if(!(p in t))return!1;if(s&&n==="shallow"&&i==="shallow"){for(p in a?t:e)if(!L.equ(e[p],t[p],{strict:a,objects:"reference"}))return!1}else for(p in a?t:e)if(e[p]!==t[p])return!1;if(L.und(p)){if(m&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function wr(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function br(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ie(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return n=i.reduce((s,m)=>s[m],e),{target:n,key:a}}else return{target:n,key:t}}const nt=/-\d+$/;function je(e,t,n){if(L.str(n)){if(nt.test(n)){const s=n.replace(nt,""),{target:m,key:p}=Ie(e,s);Array.isArray(m[p])||(m[p]=[])}const{target:i,key:a}=Ie(e,n);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=n(e,t)}function ot(e,t,n){var i,a;if(L.str(n)){const{target:s,key:m}=Ie(e,n),p=t.__r3f.previousAttach;p===void 0?delete s[m]:s[m]=p}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function wt(e,{children:t,key:n,ref:i,...a},{children:s,key:m,ref:p,...u}={},g=!1){const r=e.__r3f,o=Object.entries(a),c=[];if(g){const y=Object.keys(u);for(let P=0;P<y.length;P++)a.hasOwnProperty(y[P])||o.unshift([y[P],gt+"remove"])}o.forEach(([y,P])=>{var d;if((d=e.__r3f)!=null&&d.primitive&&y==="object"||L.equ(P,u[y]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(y))return c.push([y,P,!0,[]]);let l=[];y.includes("-")&&(l=y.split("-")),c.push([y,P,!1,l]);for(const v in a){const x=a[v];v.startsWith(`${y}-`)&&c.push([v,x,!1,v.split("-")])}});const h={...a};return r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.args&&(h.args=r.memoizedProps.args),r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.attach&&(h.attach=r.memoizedProps.attach),{memoized:h,changes:c}}const Pr=typeof process<"u"&&!1;function Ae(e,t){var n;const i=e.__r3f,a=i==null?void 0:i.root,s=a==null||a.getState==null?void 0:a.getState(),{memoized:m,changes:p}=yr(t)?t:wt(e,t),u=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=m);for(let r=0;r<p.length;r++){let[o,c,h,y]=p[r];if(Oe(e)){const v="srgb",x="srgb-linear";o==="encoding"?(o="colorSpace",c=c===3001?v:x):o==="outputEncoding"&&(o="outputColorSpace",c=c===3001?v:x)}let P=e,d=P[o];if(y.length&&(d=y.reduce((l,v)=>l[v],e),!(d&&d.set))){const[l,...v]=y.reverse();P=v.reverse().reduce((x,M)=>x[M],e),o=l}if(c===gt+"remove")if(P.constructor){let l=rt.get(P.constructor);l||(l=new P.constructor,rt.set(P.constructor,l)),c=l[o]}else c=0;if(h&&i)c?i.handlers[o]=c:delete i.handlers[o],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof Se)){if(Array.isArray(c))d.fromArray?d.fromArray(c):d.set(...c);else if(d.copy&&c&&c.constructor&&(Pr?d.constructor.name===c.constructor.name:d.constructor===c.constructor))d.copy(c);else if(c!==void 0){const l=d instanceof ft;!l&&d.setScalar?d.setScalar(c):d instanceof Se&&c instanceof Se?d.mask=c.mask:d.set(c),!pt()&&s&&!s.linear&&l&&d.convertSRGBToLinear()}}else if(P[o]=c,P[o]instanceof Ft&&P[o].format===It&&P[o].type===Ht&&s){const l=P[o];Oe(l)&&Oe(s.gl)?l.colorSpace=s.gl.outputColorSpace:l.encoding=s.gl.outputEncoding}ie(e)}if(i&&i.parent&&e.raycast&&u!==i.eventCount){const r=Ee(e).getState().internal,o=r.interaction.indexOf(e);o>-1&&r.interaction.splice(o,1),i.eventCount&&r.interaction.push(e)}return!(p.length===1&&p[0][0]==="onUpdate")&&p.length&&(n=e.__r3f)!=null&&n.parent&&He(e),e}function ie(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function He(e){e.onUpdate==null||e.onUpdate(e)}function xr(e,t){e.manual||(mt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function be(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Er(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function bt(e,t,n,i){const a=n.get(t);a&&(n.delete(t),n.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function _r(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(a)}),n.capturedMap.forEach((i,a)=>{bt(n.capturedMap,t,i,a)})}function Mr(e){function t(u){const{internal:g}=e.getState(),r=u.offsetX-g.initialClick[0],o=u.offsetY-g.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(u){return u.filter(g=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(u,g){const r=e.getState(),o=new Set,c=[],h=g?g(r.internal.interaction):r.internal.interaction;for(let l=0;l<h.length;l++){const v=fe(h[l]);v&&(v.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(u,r);function y(l){const v=fe(l);if(!v||!v.events.enabled||v.raycaster.camera===null)return[];if(v.raycaster.camera===void 0){var x;v.events.compute==null||v.events.compute(u,v,(x=v.previousRoot)==null?void 0:x.getState()),v.raycaster.camera===void 0&&(v.raycaster.camera=null)}return v.raycaster.camera?v.raycaster.intersectObject(l,!0):[]}let P=h.flatMap(y).sort((l,v)=>{const x=fe(l.object),M=fe(v.object);return!x||!M?l.distance-v.distance:M.events.priority-x.events.priority||l.distance-v.distance}).filter(l=>{const v=be(l);return o.has(v)?!1:(o.add(v),!0)});r.events.filter&&(P=r.events.filter(P,r));for(const l of P){let v=l.object;for(;v;){var d;(d=v.__r3f)!=null&&d.eventCount&&c.push({...l,eventObject:v}),v=v.parent}}if("pointerId"in u&&r.internal.capturedMap.has(u.pointerId))for(let l of r.internal.capturedMap.get(u.pointerId).values())o.has(be(l.intersection))||c.push(l.intersection);return c}function a(u,g,r,o){const c=e.getState();if(u.length){const h={stopped:!1};for(const y of u){const P=fe(y.object)||c,{raycaster:d,pointer:l,camera:v,internal:x}=P,M=new $(l.x,l.y,0).unproject(v),E=O=>{var w,j;return(w=(j=x.capturedMap.get(O))==null?void 0:j.has(y.eventObject))!=null?w:!1},b=O=>{const w={intersection:y,target:g.target};x.capturedMap.has(O)?x.capturedMap.get(O).set(y.eventObject,w):x.capturedMap.set(O,new Map([[y.eventObject,w]])),g.target.setPointerCapture(O)},C=O=>{const w=x.capturedMap.get(O);w&&bt(x.capturedMap,y.eventObject,w,O)};let R={};for(let O in g){let w=g[O];typeof w!="function"&&(R[O]=w)}let _={...y,...R,pointer:l,intersections:u,stopped:h.stopped,delta:r,unprojectedPoint:M,ray:d.ray,camera:v,stopPropagation(){const O="pointerId"in g&&x.capturedMap.get(g.pointerId);if((!O||O.has(y.eventObject))&&(_.stopped=h.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(w=>w.eventObject===y.eventObject))){const w=u.slice(0,u.indexOf(y));s([...w,y])}},target:{hasPointerCapture:E,setPointerCapture:b,releasePointerCapture:C},currentTarget:{hasPointerCapture:E,setPointerCapture:b,releasePointerCapture:C},nativeEvent:g};if(o(_),h.stopped===!0)break}}return u}function s(u){const{internal:g}=e.getState();for(const r of g.hovered.values())if(!u.length||!u.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const c=r.eventObject.__r3f,h=c==null?void 0:c.handlers;if(g.hovered.delete(be(r)),c!=null&&c.eventCount){const y={...r,intersections:u};h.onPointerOut==null||h.onPointerOut(y),h.onPointerLeave==null||h.onPointerLeave(y)}}}function m(u,g){for(let r=0;r<g.length;r++){const o=g[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(u)}}function p(u){switch(u){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return g=>{const{internal:r}=e.getState();"pointerId"in g&&r.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(g.pointerId)&&(r.capturedMap.delete(g.pointerId),s([]))})}}return function(r){const{onPointerMissed:o,internal:c}=e.getState();c.lastEvent.current=r;const h=u==="onPointerMove",y=u==="onClick"||u==="onContextMenu"||u==="onDoubleClick",d=i(r,h?n:void 0),l=y?t(r):0;u==="onPointerDown"&&(c.initialClick=[r.offsetX,r.offsetY],c.initialHits=d.map(x=>x.eventObject)),y&&!d.length&&l<=2&&(m(r,c.interaction),o&&o(r)),h&&s(d);function v(x){const M=x.eventObject,E=M.__r3f,b=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(h){if(b.onPointerOver||b.onPointerEnter||b.onPointerOut||b.onPointerLeave){const C=be(x),R=c.hovered.get(C);R?R.stopped&&x.stopPropagation():(c.hovered.set(C,x),b.onPointerOver==null||b.onPointerOver(x),b.onPointerEnter==null||b.onPointerEnter(x))}b.onPointerMove==null||b.onPointerMove(x)}else{const C=b[u];C?(!y||c.initialHits.includes(M))&&(m(r,c.interaction.filter(R=>!c.initialHits.includes(R))),C(x)):y&&c.initialHits.includes(M)&&m(r,c.interaction.filter(R=>!c.initialHits.includes(R)))}}a(d,r,l,v)}}return{handlePointer:p}}const Pt=e=>!!(e!=null&&e.render),xt=f.createContext(null),Sr=(e,t)=>{const n=dt((p,u)=>{const g=new $,r=new $,o=new $;function c(l=u().camera,v=r,x=u().size){const{width:M,height:E,top:b,left:C}=x,R=M/E;v instanceof $?o.copy(v):o.set(...v);const _=l.getWorldPosition(g).distanceTo(o);if(mt(l))return{width:M/l.zoom,height:E/l.zoom,top:b,left:C,factor:1,distance:_,aspect:R};{const O=l.fov*Math.PI/180,w=2*Math.tan(O/2)*_,j=w*(M/E);return{width:j,height:w,top:b,left:C,factor:M/j,distance:_,aspect:R}}}let h;const y=l=>p(v=>({performance:{...v.performance,current:l}})),P=new $e;return{set:p,get:u,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(u(),l),advance:(l,v)=>t(l,v,u()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Yt,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=u();h&&clearTimeout(h),l.performance.current!==l.performance.min&&y(l.performance.min),h=setTimeout(()=>y(u().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:l=>p(v=>({...v,events:{...v.events,...l}})),setSize:(l,v,x,M,E)=>{const b=u().camera,C={width:l,height:v,top:M||0,left:E||0,updateStyle:x};p(R=>({size:C,viewport:{...R.viewport,...c(b,r,C)}}))},setDpr:l=>p(v=>{const x=yt(l);return{viewport:{...v.viewport,dpr:x,initialDpr:v.viewport.initialDpr||x}}}),setFrameloop:(l="always")=>{const v=u().clock;v.stop(),v.elapsedTime=0,l!=="never"&&(v.start(),v.elapsedTime=0),p(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:f.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,v,x)=>{const M=u().internal;return M.priority=M.priority+(v>0?1:0),M.subscribers.push({ref:l,priority:v,store:x}),M.subscribers=M.subscribers.sort((E,b)=>E.priority-b.priority),()=>{const E=u().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(v>0?1:0),E.subscribers=E.subscribers.filter(b=>b.ref!==l))}}}}}),i=n.getState();let a=i.size,s=i.viewport.dpr,m=i.camera;return n.subscribe(()=>{const{camera:p,size:u,viewport:g,gl:r,set:o}=n.getState();if(u.width!==a.width||u.height!==a.height||g.dpr!==s){var c;a=u,s=g.dpr,xr(p,u),r.setPixelRatio(g.dpr);const h=(c=u.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(u.width,u.height,h)}p!==m&&(m=p,o(h=>({viewport:{...h.viewport,...h.viewport.getCurrentViewport(p)}})))}),n.subscribe(p=>e(p)),n};let Pe,Cr=new Set,Rr=new Set,Or=new Set;function Te(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function de(e,t){switch(e){case"before":return Te(Cr,t);case"after":return Te(Rr,t);case"tail":return Te(Or,t)}}let Le,De;function ke(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Le=t.internal.subscribers,Pe=0;Pe<Le.length;Pe++)De=Le[Pe],De.ref.current(De.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function jr(e){let t=!1,n=!1,i,a,s;function m(g){a=requestAnimationFrame(m),t=!0,i=0,de("before",g),n=!0;for(const o of e.values()){var r;s=o.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((r=s.gl.xr)!=null&&r.isPresenting)&&(i+=ke(g,s))}if(n=!1,de("after",g),i===0)return de("tail",g),t=!1,cancelAnimationFrame(a)}function p(g,r=1){var o;if(!g)return e.forEach(c=>p(c.store.getState(),r));(o=g.gl.xr)!=null&&o.isPresenting||!g.internal.active||g.frameloop==="never"||(r>1?g.internal.frames=Math.min(60,g.internal.frames+r):n?g.internal.frames=2:g.internal.frames=1,t||(t=!0,requestAnimationFrame(m)))}function u(g,r=!0,o,c){if(r&&de("before",g),o)ke(g,o,c);else for(const h of e.values())ke(g,h.store.getState());r&&de("after",g)}return{loop:m,invalidate:p,advance:u}}function Et(){const e=f.useContext(xt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function F(e=n=>n,t){return Et()(e,t)}function ce(e,t=0){const n=Et(),i=n.getState().internal.subscribe,a=vt(e);return ve(()=>i(a,t,n),[t,i,n]),null}const it=new WeakMap;function _t(e,t){return function(n,...i){let a=it.get(n);return a||(a=new n,it.set(n,a)),e&&e(a),Promise.all(i.map(s=>new Promise((m,p)=>a.load(s,u=>{u.scene&&Object.assign(u,wr(u.scene)),m(u)},t,u=>p(new Error(`Could not load ${s}: ${u==null?void 0:u.message}`))))))}}function he(e,t,n,i){const a=Array.isArray(t)?t:[t],s=fr(_t(n,i),[e,...a],{equal:L.equ});return Array.isArray(t)?s:s[0]}he.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return dr(_t(n),[e,...i])};he.clear=function(e,t){const n=Array.isArray(t)?t:[t];return pr([e,...n])};const le=new Map,{invalidate:st,advance:at}=jr(le),{reconciler:_e,applyProps:re}=vr(le,Er),ne={objects:"shallow",strict:!1},Ar=(e,t)=>{const n=typeof e=="function"?e(t):e;return Pt(n)?n:new Vt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Tr(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:a,top:s,left:m,updateStyle:p=n}=t;return{width:i,height:a,top:s,left:m,updateStyle:p}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:a,top:s,left:m}=e.parentElement.getBoundingClientRect();return{width:i,height:a,top:s,left:m,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Lr(e){const t=le.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,s=i||Sr(st,at),m=n||_e.createContainer(s,se.ConcurrentRoot,null,!1,null,"",a,null);t||le.set(e,{fiber:m,store:s});let p,u=!1,g;return{configure(r={}){let{gl:o,size:c,scene:h,events:y,onCreated:P,shadows:d=!1,linear:l=!1,flat:v=!1,legacy:x=!1,orthographic:M=!1,frameloop:E="always",dpr:b=[1,2],performance:C,raycaster:R,camera:_,onPointerMissed:O}=r,w=s.getState(),j=w.gl;w.gl||w.set({gl:j=Ar(o,e)});let H=w.raycaster;H||w.set({raycaster:H=new Wt});const{params:X,...k}=R||{};if(L.equ(k,H,ne)||re(H,{...k}),L.equ(X,H.params,ne)||re(H,{params:{...H.params,...X}}),!w.camera||w.camera===g&&!L.equ(g,_,ne)){g=_;const A=_ instanceof Gt,T=A?_:M?new Ne(0,0,0,0,.1,1e3):new Be(75,0,.1,1e3);A||(T.position.z=5,_&&(re(T,_),("aspect"in _||"left"in _||"right"in _||"bottom"in _||"top"in _)&&(T.manual=!0,T.updateProjectionMatrix())),!w.camera&&!(_!=null&&_.rotation)&&T.lookAt(0,0,0)),w.set({camera:T}),H.camera=T}if(!w.scene){let A;h instanceof Je?A=h:(A=new Je,h&&re(A,h)),w.set({scene:oe(A)})}if(!w.xr){var V;const A=(S,Z)=>{const G=s.getState();G.frameloop!=="never"&&at(S,!0,G,Z)},T=()=>{const S=s.getState();S.gl.xr.enabled=S.gl.xr.isPresenting,S.gl.xr.setAnimationLoop(S.gl.xr.isPresenting?A:null),S.gl.xr.isPresenting||st(S)},I={connect(){const S=s.getState().gl;S.xr.addEventListener("sessionstart",T),S.xr.addEventListener("sessionend",T)},disconnect(){const S=s.getState().gl;S.xr.removeEventListener("sessionstart",T),S.xr.removeEventListener("sessionend",T)}};typeof((V=j.xr)==null?void 0:V.addEventListener)=="function"&&I.connect(),w.set({xr:I})}if(j.shadowMap){const A=j.shadowMap.enabled,T=j.shadowMap.type;if(j.shadowMap.enabled=!!d,L.boo(d))j.shadowMap.type=Ce;else if(L.str(d)){var z;const I={basic:qt,percentage:Zt,soft:Ce,variance:Xt};j.shadowMap.type=(z=I[d])!=null?z:Ce}else L.obj(d)&&Object.assign(j.shadowMap,d);(A!==j.shadowMap.enabled||T!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}const W=pt();W&&("enabled"in W?W.enabled=!x:"legacyMode"in W&&(W.legacyMode=x)),u||re(j,{outputEncoding:l?3e3:3001,toneMapping:v?Nt:Bt}),w.legacy!==x&&w.set(()=>({legacy:x})),w.linear!==l&&w.set(()=>({linear:l})),w.flat!==v&&w.set(()=>({flat:v})),o&&!L.fun(o)&&!Pt(o)&&!L.equ(o,j,ne)&&re(j,o),y&&!w.events.handlers&&w.set({events:y(s)});const N=Tr(e,c);return L.equ(N,w.size,ne)||w.setSize(N.width,N.height,N.updateStyle,N.top,N.left),b&&w.viewport.dpr!==yt(b)&&w.setDpr(b),w.frameloop!==E&&w.setFrameloop(E),w.onPointerMissed||w.set({onPointerMissed:O}),C&&!L.equ(C,w.performance,ne)&&w.set(A=>({performance:{...A.performance,...C}})),p=P,u=!0,this},render(r){return u||this.configure(),_e.updateContainer(U.jsx(Dr,{store:s,children:r,onCreated:p,rootElement:e}),m,null,()=>{}),s},unmount(){Mt(e)}}}function Dr({store:e,children:t,onCreated:n,rootElement:i}){return ve(()=>{const a=e.getState();a.set(s=>({internal:{...s.internal,active:!0}})),n&&n(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),U.jsx(xt.Provider,{value:e,children:t})}function Mt(e,t){const n=le.get(e),i=n==null?void 0:n.fiber;if(i){const a=n==null?void 0:n.store.getState();a&&(a.internal.active=!1),_e.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var s,m,p,u;a.events.disconnect==null||a.events.disconnect(),(s=a.gl)==null||(m=s.renderLists)==null||m.dispose==null||m.dispose(),(p=a.gl)==null||p.forceContextLoss==null||p.forceContextLoss(),(u=a.gl)!=null&&u.xr&&a.xr.disconnect(),br(a),le.delete(e)}catch{}},500)})}}_e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:f.version});const ze={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function kr(e){const{handlePointer:t}=Mr(e);return{priority:1,enabled:!0,compute(n,i,a){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ze).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:a}=e.getState();(n=a.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:n=>{var i;const{set:a,events:s}=e.getState();s.disconnect==null||s.disconnect(),a(m=>({events:{...m.events,connected:n}})),Object.entries((i=s.handlers)!=null?i:[]).forEach(([m,p])=>{const[u,g]=ze[m];n.addEventListener(u,p,{passive:g})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([s,m])=>{if(i&&i.connected instanceof HTMLElement){const[p]=ze[s];i.connected.removeEventListener(p,m)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}const zr=f.forwardRef(function({children:t,fallback:n,resize:i,style:a,gl:s,events:m=kr,eventSource:p,eventPrefix:u,shadows:g,linear:r,flat:o,legacy:c,orthographic:h,frameloop:y,dpr:P,performance:d,raycaster:l,camera:v,scene:x,onPointerMissed:M,onCreated:E,...b},C){f.useMemo(()=>mr(Kt),[]);const R=sr(),[_,O]=or({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=f.useRef(null),j=f.useRef(null);f.useImperativeHandle(C,()=>w.current);const H=vt(M),[X,k]=f.useState(!1),[V,z]=f.useState(!1);if(X)throw X;if(V)throw V;const W=f.useRef(null);ve(()=>{const A=w.current;O.width>0&&O.height>0&&A&&(W.current||(W.current=Lr(A)),W.current.configure({gl:s,events:m,shadows:g,linear:r,flat:o,legacy:c,orthographic:h,frameloop:y,dpr:P,performance:d,raycaster:l,camera:v,scene:x,size:O,onPointerMissed:(...T)=>H.current==null?void 0:H.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(p?hr(p)?p.current:p:j.current),u&&T.setEvents({compute:(I,S)=>{const Z=I[u+"X"],G=I[u+"Y"];S.pointer.set(Z/S.size.width*2-1,-(G/S.size.height)*2+1),S.raycaster.setFromCamera(S.pointer,S.camera)}}),E==null||E(T)}}),W.current.render(U.jsx(R,{children:U.jsx(ht,{set:z,children:U.jsx(f.Suspense,{fallback:U.jsx(gr,{set:k}),children:t})})})))}),f.useEffect(()=>{const A=w.current;if(A)return()=>Mt(A)},[]);const N=p?"none":"auto";return U.jsx("div",{ref:j,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:N,...a},...b,children:U.jsx("div",{ref:_,style:{width:"100%",height:"100%"},children:U.jsx("canvas",{ref:w,style:{display:"block"},children:n})})})}),dn=f.forwardRef(function(t,n){return U.jsx(ir,{children:U.jsx(zr,{...t,ref:n})})}),ge=new $,Ge=new $,Fr=new $,lt=new $e;function Ir(e,t,n){const i=ge.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=n.width/2,s=n.height/2;return[i.x*a+a,-(i.y*s)+s]}function Hr(e,t){const n=ge.setFromMatrixPosition(e.matrixWorld),i=Ge.setFromMatrixPosition(t.matrixWorld),a=n.sub(i),s=t.getWorldDirection(Fr);return a.angleTo(s)>Math.PI/2}function Wr(e,t,n,i){const a=ge.setFromMatrixPosition(e.matrixWorld),s=a.clone();s.project(t),lt.set(s.x,s.y),n.setFromCamera(lt,t);const m=n.intersectObjects(i,!0);if(m.length){const p=m[0].distance;return a.distanceTo(n.ray.origin)<p}return!0}function Nr(e,t){if(t instanceof Ne)return t.zoom;if(t instanceof Be){const n=ge.setFromMatrixPosition(e.matrixWorld),i=Ge.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,s=n.distanceTo(i);return 1/(2*Math.tan(a/2)*s)}else return 1}function Br(e,t,n){if(t instanceof Be||t instanceof Ne){const i=ge.setFromMatrixPosition(e.matrixWorld),a=Ge.setFromMatrixPosition(t.matrixWorld),s=i.distanceTo(a),m=(n[1]-n[0])/(t.far-t.near),p=n[1]-m*t.far;return Math.round(m*s+p)}}const We=e=>Math.abs(e)<1e-10?0:e;function St(e,t,n=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=We(t[a]*e.elements[a])+(a!==15?",":")");return n+i}const $r=(e=>t=>St(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Ur=(e=>(t,n)=>St(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Vr(e){return e&&typeof e=="object"&&"current"in e}const pn=f.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:a,center:s,fullscreen:m,portal:p,distanceFactor:u,sprite:g=!1,transform:r=!1,occlude:o,onOcclude:c,castShadow:h,receiveShadow:y,material:P,geometry:d,zIndexRange:l=[16777271,0],calculatePosition:v=Ir,as:x="div",wrapperClass:M,pointerEvents:E="auto",...b},C)=>{const{gl:R,camera:_,scene:O,size:w,raycaster:j,events:H,viewport:X}=F(),[k]=f.useState(()=>document.createElement(x)),V=f.useRef(),z=f.useRef(null),W=f.useRef(0),N=f.useRef([0,0]),A=f.useRef(null),T=f.useRef(null),I=(p==null?void 0:p.current)||H.connected||R.domElement.parentNode,S=f.useRef(null),Z=f.useRef(!1),G=f.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Vr(o[0]),[o]);f.useLayoutEffect(()=>{const B=R.domElement;o&&o==="blending"?(B.style.zIndex=`${Math.floor(l[0]/2)}`,B.style.position="absolute",B.style.pointerEvents="none"):(B.style.zIndex=null,B.style.position=null,B.style.pointerEvents=null)},[o]),f.useLayoutEffect(()=>{if(z.current){const B=V.current=lr(k);if(O.updateMatrixWorld(),r)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const D=v(z.current,_,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${D[0]}px,${D[1]}px,0);transform-origin:0 0;`}return I&&(a?I.prepend(k):I.appendChild(k)),()=>{I&&I.removeChild(k),B.unmount()}}},[I,r]),f.useLayoutEffect(()=>{M&&(k.className=M)},[M]);const Ze=f.useMemo(()=>r?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...m&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...n},[n,s,m,w,r]),Ot=f.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);f.useLayoutEffect(()=>{if(Z.current=!1,r){var B;(B=V.current)==null||B.render(f.createElement("div",{ref:A,style:Ze},f.createElement("div",{ref:T,style:Ot},f.createElement("div",{ref:C,className:i,style:n,children:e}))))}else{var D;(D=V.current)==null||D.render(f.createElement("div",{ref:C,style:Ze,className:i,children:e}))}});const te=f.useRef(!0);ce(B=>{if(z.current){_.updateMatrixWorld(),z.current.updateWorldMatrix(!0,!1);const D=r?N.current:v(z.current,_,w);if(r||Math.abs(W.current-_.zoom)>t||Math.abs(N.current[0]-D[0])>t||Math.abs(N.current[1]-D[1])>t){const Y=Hr(z.current,_);let q=!1;G&&(Array.isArray(o)?q=o.map(K=>K.current):o!=="blending"&&(q=[O]));const ue=te.current;if(q){const K=Wr(z.current,_,j,q);te.current=K&&!Y}else te.current=!Y;ue!==te.current&&(c?c(!te.current):k.style.display=te.current?"block":"none");const ye=Math.floor(l[0]/2),jt=o?G?[l[0],ye]:[ye-1,0]:l;if(k.style.zIndex=`${Br(z.current,_,jt)}`,r){const[K,Ye]=[w.width/2,w.height/2],Me=_.projectionMatrix.elements[5]*Ye,{isOrthographicCamera:Ke,top:At,left:Tt,bottom:Lt,right:Dt}=_,kt=$r(_.matrixWorldInverse),zt=Ke?`scale(${Me})translate(${We(-(Dt+Tt)/2)}px,${We((At+Lt)/2)}px)`:`translateZ(${Me}px)`;let J=z.current.matrixWorld;g&&(J=_.matrixWorldInverse.clone().transpose().copyPosition(J).scale(z.current.scale),J.elements[3]=J.elements[7]=J.elements[11]=0,J.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Ke?"":`${Me}px`,A.current&&T.current&&(A.current.style.transform=`${zt}${kt}translate(${K}px,${Ye}px)`,T.current.style.transform=Ur(J,1/((u||10)/400)))}else{const K=u===void 0?1:Nr(z.current,_)*u;k.style.transform=`translate3d(${D[0]}px,${D[1]}px,0) scale(${K})`}N.current=D,W.current=_.zoom}}if(!G&&S.current&&!Z.current)if(r){if(A.current){const D=A.current.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const{isOrthographicCamera:Y}=_;if(Y||d)b.scale&&(Array.isArray(b.scale)?b.scale instanceof $?S.current.scale.copy(b.scale.clone().divideScalar(1)):S.current.scale.set(1/b.scale[0],1/b.scale[1],1/b.scale[2]):S.current.scale.setScalar(1/b.scale));else{const q=(u||10)/400,ue=D.clientWidth*q,ye=D.clientHeight*q;S.current.scale.set(ue,ye,1)}Z.current=!0}}}else{const D=k.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const Y=1/X.factor,q=D.clientWidth*Y,ue=D.clientHeight*Y;S.current.scale.set(q,ue,1),Z.current=!0}S.current.lookAt(B.camera.position)}});const Xe=f.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return f.createElement("group",ee({},b,{ref:z}),o&&!G&&f.createElement("mesh",{castShadow:h,receiveShadow:y,ref:S},d||f.createElement("planeGeometry",null),P||f.createElement("shaderMaterial",{side:Jt,vertexShader:Xe.vertexShader,fragmentShader:Xe.fragmentShader})))});let pe=0;const mn=dt(e=>(we.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-pe)/(i-pe)*100})},we.onLoad=()=>{e({active:!1})},we.onError=t=>e(n=>({errors:[...n.errors,t]})),we.onProgress=(t,n,i)=>{n===i&&(pe=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-pe)/(i-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Gr=()=>parseInt(Qt.replace(/\D+/g,"")),qr=Gr();let xe=null,Ct="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Rt(e,t,n){return i=>{n&&n(i),e&&(xe||(xe=new cr),xe.setDecoderPath(typeof e=="string"?e:Ct),i.setDRACOLoader(xe)),t&&i.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}function qe(e,t=!0,n=!0,i){return he(Ue,e,Rt(t,n,i))}qe.preload=(e,t=!0,n=!0,i)=>he.preload(Ue,e,Rt(t,n,i));qe.clear=e=>he.clear(Ue,e);qe.setDecoderPath=e=>{Ct=e};const vn=f.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:a=!0,keyEvents:s=!1,onChange:m,onStart:p,onEnd:u,...g},r)=>{const o=F(b=>b.invalidate),c=F(b=>b.camera),h=F(b=>b.gl),y=F(b=>b.events),P=F(b=>b.setEvents),d=F(b=>b.set),l=F(b=>b.get),v=F(b=>b.performance),x=t||c,M=i||y.connected||h.domElement,E=f.useMemo(()=>new ur(x),[x]);return ce(()=>{E.enabled&&E.update()},-1),f.useEffect(()=>(s&&E.connect(s===!0?M:s),E.connect(M),()=>void E.dispose()),[s,M,n,E,o]),f.useEffect(()=>{const b=_=>{o(),n&&v.regress(),m&&m(_)},C=_=>{p&&p(_)},R=_=>{u&&u(_)};return E.addEventListener("change",b),E.addEventListener("start",C),E.addEventListener("end",R),()=>{E.removeEventListener("start",C),E.removeEventListener("end",R),E.removeEventListener("change",b)}},[m,p,u,E,o,P]),f.useEffect(()=>{if(e){const b=l().controls;return d({controls:E}),()=>d({controls:b})}},[e,E]),f.createElement("primitive",ee({ref:r,object:E,enableDamping:a},g))});function hn(e,t,...n){const i=f.useRef(),a=F(s=>s.scene);return f.useLayoutEffect(()=>{let s;if(e&&e!=null&&e.current&&t&&(i.current=s=new t(e.current,...n)),s)return s.traverse(m=>m.raycast=()=>null),a.add(s),()=>{i.current=void 0,a.remove(s),s.dispose==null||s.dispose()}},[a,t,e,...n]),ce(()=>{var s;return void((s=i.current)==null||s.update==null?void 0:s.update())}),i}class Zr extends er{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new $(0,0,0)},lightColor:{value:new ft("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new $e(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;
        uniform vec3 spotPosition;
        uniform float attenuation;

        #include <common>
        #include <logdepthbuf_pars_vertex>

        void main() {
          // compute intensity
          vNormal = normalize(normalMatrix * normal);
          vec4 worldPosition = modelMatrix * vec4(position, 1);
          vec4 viewPosition = viewMatrix * worldPosition;
          vViewZ = viewPosition.z;

          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);

          gl_Position = projectionMatrix * viewPosition;

          #include <logdepthbuf_vertex>
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;

        uniform vec3 lightColor;
        uniform float anglePower;
        uniform sampler2D depth;
        uniform vec2 resolution;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float opacity;

        #include <packing>
        #include <logdepthbuf_pars_fragment>

        float readDepth(sampler2D depthSampler, vec2 uv) {
          float fragCoordZ = texture(depthSampler, uv).r;

          // https://github.com/mrdoob/three.js/issues/23072
          #ifdef USE_LOGDEPTHBUF
            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));
          #else
            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
          #endif

          return viewZ;
        }

        void main() {
          #include <logdepthbuf_fragment>

          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);
          float intensity = vIntensity * angleIntensity;

          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
          if (isSoft) {
            vec2 uv = gl_FragCoord.xy / resolution;
            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));
          }

          gl_FragColor = vec4(lightColor, intensity * opacity);

          #include <tonemapping_fragment>
          #include <${qr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}}function Xr({opacity:e=1,radiusTop:t,radiusBottom:n,depthBuffer:i,color:a="white",distance:s=5,angle:m=.15,attenuation:p=5,anglePower:u=5}){const g=f.useRef(null),r=F(d=>d.size),o=F(d=>d.camera),c=F(d=>d.viewport.dpr),[h]=f.useState(()=>new Zr),[y]=f.useState(()=>new $);t=t===void 0?.1:t,n=n===void 0?m*7:n,ce(()=>{h.uniforms.spotPosition.value.copy(g.current.getWorldPosition(y)),g.current.lookAt(g.current.parent.target.getWorldPosition(y))});const P=f.useMemo(()=>{const d=new tr(t,n,s,128,64,!0);return d.applyMatrix4(new Fe().makeTranslation(0,-s/2,0)),d.applyMatrix4(new Fe().makeRotationX(-Math.PI/2)),d},[s,t,n]);return f.createElement(f.Fragment,null,f.createElement("mesh",{ref:g,geometry:P,raycast:()=>null},f.createElement("primitive",{object:h,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":a,"uniforms-attenuation-value":p,"uniforms-anglePower-value":u,"uniforms-depth-value":i,"uniforms-cameraNear-value":o.near,"uniforms-cameraFar-value":o.far,"uniforms-resolution-value":i?[r.width*c,r.height*c]:[0,0]})))}const gn=f.forwardRef(({opacity:e=1,radiusTop:t,radiusBottom:n,depthBuffer:i,color:a="white",distance:s=5,angle:m=.15,attenuation:p=5,anglePower:u=5,volumetric:g=!0,debug:r=!1,children:o,...c},h)=>{const y=f.useRef(null);return f.useImperativeHandle(h,()=>y.current,[]),f.createElement("group",null,r&&y.current&&f.createElement("spotLightHelper",{args:[y.current]}),f.createElement("spotLight",ee({ref:y,angle:m,color:a,distance:s,castShadow:!0},c),g&&f.createElement(Xr,{debug:r,opacity:e,radiusTop:t,radiusBottom:n,depthBuffer:i,color:a,distance:s,angle:m,attenuation:p,anglePower:u})),o&&f.cloneElement(o,{spotlightRef:y,debug:r}))});let Q,me;const Yr=f.createContext(null),ct=new Fe,ut=new $,Kr=f.forwardRef(({children:e,range:t,limit:n=1e3,...i},a)=>{const s=f.useRef(null);f.useImperativeHandle(a,()=>s.current,[]);const[m,p]=f.useState([]),[[u,g,r]]=f.useState(()=>[new Float32Array(n*3),Float32Array.from({length:n*3},()=>1),Float32Array.from({length:n},()=>1)]);f.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),ce(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),ct.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(n,t!==void 0?t:n,m.length),Q=0;Q<m.length;Q++)me=m[Q].current,me.getWorldPosition(ut).applyMatrix4(ct),ut.toArray(u,Q*3),s.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(g,Q*3),s.current.geometry.attributes.color.needsUpdate=!0,r.set([me.size],Q),s.current.geometry.attributes.size.needsUpdate=!0});const o=f.useMemo(()=>({getParent:()=>s,subscribe:c=>(p(h=>[...h,c]),()=>p(h=>h.filter(y=>y.current!==c.current)))}),[]);return f.createElement("points",ee({userData:{instances:m},matrixAutoUpdate:!1,ref:s,raycast:()=>null},i),f.createElement("bufferGeometry",null,f.createElement("bufferAttribute",{attach:"attributes-position",count:u.length/3,array:u,itemSize:3,usage:ae}),f.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:ae}),f.createElement("bufferAttribute",{attach:"attributes-size",count:r.length,array:r,itemSize:1,usage:ae})),f.createElement(Yr.Provider,{value:o},e))}),Jr=f.forwardRef(({children:e,positions:t,colors:n,sizes:i,stride:a=3,...s},m)=>{const p=f.useRef(null);return f.useImperativeHandle(m,()=>p.current,[]),ce(()=>{const u=p.current.geometry.attributes;u.position.needsUpdate=!0,n&&(u.color.needsUpdate=!0),i&&(u.size.needsUpdate=!0)}),f.createElement("points",ee({ref:p},s),f.createElement("bufferGeometry",null,f.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:ae}),n&&f.createElement("bufferAttribute",{attach:"attributes-color",count:n.length/a,array:n,itemSize:3,usage:ae}),i&&f.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/a,array:i,itemSize:1,usage:ae})),e)}),yn=f.forwardRef((e,t)=>e.positions instanceof Float32Array?f.createElement(Jr,ee({},e,{ref:t})):f.createElement(Kr,ee({},e,{ref:t})));function wn({all:e,scene:t,camera:n}){const i=F(({gl:m})=>m),a=F(({camera:m})=>m),s=F(({scene:m})=>m);return f.useLayoutEffect(()=>{const m=[];e&&(t||s).traverse(g=>{g.visible===!1&&(m.push(g),g.visible=!0)}),i.compile(t||s,n||a);const p=new rr(128);new nr(.01,1e5,p).update(i,t||s),p.dispose(),m.forEach(g=>g.visible=!1)},[]),null}export{dn as C,pn as H,vn as O,wn as P,gn as S,qe as a,hn as b,ce as c,yn as d,mn as u};
